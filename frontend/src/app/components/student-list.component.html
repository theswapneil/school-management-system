<div class="container">
  <div class="header">
    <h1>Students List</h1>
    <button mat-raised-button color="primary" *ngIf="canCreateStudent()">
      Add New Student
    </button>
  </div>

  <mat-card class="table-container">
    <mat-spinner *ngIf="isLoading()" diameter="50"></mat-spinner>

    <table mat-table [dataSource]="students()" class="student-table" *ngIf="!isLoading()">
      <!-- Registration Number Column -->
      <ng-container matColumnDef="registrationNumber">
        <th mat-header-cell *matHeaderCellDef>Registration #</th>
        <td mat-cell *matCellDef="let element">{{ element.registrationNumber }}</td>
      </ng-container>

      <!-- Student Name Column -->
      <ng-container matColumnDef="studentName">
        <th mat-header-cell *matHeaderCellDef>Student Name</th>
        <td mat-cell *matCellDef="let element">
          {{ element.user?.firstName }} {{ element.user?.lastName }}
        </td>
      </ng-container>

      <!-- Email Column -->
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef>Email</th>
        <td mat-cell *matCellDef="let element">{{ element.user?.email }}</td>
      </ng-container>

      <!-- Class Column -->
      <ng-container matColumnDef="class">
        <th mat-header-cell *matHeaderCellDef>Class</th>
        <td mat-cell *matCellDef="let element">
          {{ element.class?.name }} ({{ element.class?.grade }})
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let element">
          <span [ngClass]="'status-' + element.status">
            {{ element.status | titlecase }}
          </span>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let element">
          <button
            mat-icon-button
            [disabled]="!canEditStudent()"
            (click)="editStudent(element.id)"
          >
            Edit
          </button>
          <button
            mat-icon-button
            color="warn"
            [disabled]="!canDeleteStudent()"
            (click)="deleteStudent(element.id)"
          >
            Delete
          </button>
        </td>
      </ng-container>

      <!-- Table -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <div class="no-data" *ngIf="!isLoading() && students().length === 0">
      <p>No students found.</p>
    </div>
  </mat-card>
</div>
